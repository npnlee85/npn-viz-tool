/*
 * Regs-Dot-Gov-Directives
 * Version: 0.1.0 - 2015-02-18
 */
angular.module("npn-viz-tool.filters",[]).filter("trim",function(){return function(a){return angular.isString(a)?a.trim():a}}).filter("faFileIcon",function(){var a={pdf:"fa-file-pdf-o"};return function(b){return b&&!a[b]&&console.debug("no explicit file type icon for "+b),a[b]||"fa-file-o"}}).filter("ellipses",function(){return function(a){var b=2==arguments.length?arguments[1]:55;return"string"==typeof a&&a.length>b?a.substring(0,b)+" ...":a}}),angular.module("npn-viz-tool",["templates-npnvis","npn-viz-tool.services","npn-viz-tool.map","npn-viz-tool.filters","uiGmapgoogle-maps","ui.bootstrap","ngAnimate"]).config(function(a){a.configure({v:"3.17",libraries:"geometry"})}),angular.module("npn-viz-tool.map",[]).directive("npnVizMap",["uiGmapGoogleMapApi","uiGmapIsReady",function(a){return{restrict:"E",templateUrl:"js/map/map.html",scope:{},controller:["$scope",function(b){a.then(function(a){console.log("maps",a),b.map={center:{latitude:38.8402805,longitude:-97.61142369999999},zoom:4,options:{streetViewControl:!1,panControl:!1,zoomControl:!0,zoomControlOptions:{style:a.ZoomControlStyle.SMALL,position:a.ControlPosition.RIGHT_TOP}}}})}]}}]).directive("npnVizLayers",["uiGmapIsReady","$http","LayerService",function(a,b,c){return{restrict:"E",template:"",scope:{},controller:["$scope",function(a){function d(){if(a.featureMap&&a.countMap){console.log("$countMap",a.countMap);var b=a.map,d=d3.scale.linear().domain([a.countMap.$min,a.countMap.$max]).range(["#F7FBFF","#08306B"]);b.data.setStyle(function(b){var c=b.getProperty("NAME"),e=a.countMap[c],f={strokeOpacity:1,strokeColor:"#ffffff",strokeWeight:1,fillOpacity:0};return e?(f.fillOpacity=.8,f.fillColor=d(e.number_stations),f.clickable=!0):console.warn("no count for "+c),f}),b.data.addListener("mouseover",function(a){console.log("feature",a.feature),console.log("state",a.feature.getProperty("NAME")),b.data.overrideStyle(a.feature,{strokeWeight:2})}),b.data.addListener("mouseout",function(){b.data.revertStyle()}),c.loadLayer("hij")}}c.resetLayers().then(function(){c.loadLayer("US States",{strokeOpacity:0,fillOpacity:0}).then(function(b){a.map=b[0],a.featureMap=b[1].reduce(function(a,b){return a[b.getProperty("NAME")]=b,a},{})})}),b.get("/npn_portal/stations/getStationCountByState.json").success(function(b){a.countMap=b.reduce(function(a,b){return a[b.state]=b,b.number_stations=parseInt(b.number_stations),a.$min=Math.min(a.$min,b.number_stations),a.$max=Math.max(a.$max,b.number_stations),a},{$max:0,$min:0})}),a.$watch("countMap",d),a.$watch("featureMap",d)}]}}]),angular.module("templates-npnvis",["js/map/map.html"]),angular.module("js/map/map.html",[]).run(["$templateCache",function(a){a.put("js/map/map.html","<ui-gmap-google-map ng-if=\"map\" center='map.center' zoom='map.zoom' options=\"map.options\">\n\n</ui-gmap-google-map>\n\n<npn-viz-layers></npn-viz-layers>")}]),angular.module("npn-viz-tool.services",["ngResource"]).factory("LayerService",["$http","$q","uiGmapIsReady",function(a,b,c){function d(c){var d=b.defer();return c.data?d.resolve(c):a.get("layers/"+c.file).success(function(a){c.data=a,d.resolve(c)}),d.promise}var e=null,f=null,g=c.promise(1).then(function(b){return f=b[0].map,console.log("LayerService - map is ready"),a.get("layers/layers.json").success(function(a){e={},a.forEach(function(a){e[a.label]=a}),console.log("LayerService - layer list is loaded",e)})});return{resetLayers:function(){var a=b.defer();return g.then(function(){for(var b in e){var c,d=e[b];if(d.loaded){for(c=0;c<d.loaded.length;c++)f.data.remove(d.loaded[c]);delete d.loaded}}a.resolve()}),a.promise},loadLayer:function(a,c){var h=b.defer();return g.then(function(){var b=e[a];return b?void d(b).then(function(){b.style=c,b.loaded=f.data.addGeoJson(b.data),b.loaded.forEach(function(a){a.setProperty("$style",c)}),f.data.setStyle(function(a){var b={strokeColor:"#ffffff",strokeOpacity:null,strokeWeight:1,fillColor:"#c0c5b8",fillOpacity:null},c=a.getProperty("$style");return c?angular.extend(b,c):b}),h.resolve([f,b.loaded])}):(console.log("no such layer labeled",a),h.reject(a))}),h.promise}}}]);