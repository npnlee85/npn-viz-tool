/*
 * Regs-Dot-Gov-Directives
 * Version: 0.1.0 - 2015-02-18
 */
angular.module("npn-viz-tool.filters",[]).filter("trim",function(){return function(a){return angular.isString(a)?a.trim():a}}).filter("faFileIcon",function(){var a={pdf:"fa-file-pdf-o"};return function(b){return b&&!a[b]&&console.debug("no explicit file type icon for "+b),a[b]||"fa-file-o"}}).filter("ellipses",function(){return function(a){var b=2==arguments.length?arguments[1]:55;return"string"==typeof a&&a.length>b?a.substring(0,b)+" ...":a}}),angular.module("npn-viz-tool",["templates-npnvis","npn-viz-tool.services","npn-viz-tool.map","npn-viz-tool.filters","uiGmapgoogle-maps","ui.bootstrap","ngAnimate"]).config(function(a){a.configure({v:"3.17",libraries:"geometry"})}),angular.module("npn-viz-tool.map",[]).directive("npnVizMap",["uiGmapGoogleMapApi","uiGmapIsReady",function(a){return{restrict:"E",templateUrl:"js/map/map.html",scope:{},controller:["$scope",function(b){a.then(function(a){console.log("maps",a),b.map={center:{latitude:38.8402805,longitude:-97.61142369999999},zoom:4,options:{streetViewControl:!1,panControl:!1,zoomControl:!0,zoomControlOptions:{style:a.ZoomControlStyle.SMALL,position:a.ControlPosition.RIGHT_TOP}}}})}]}}]).directive("npnVizLayers",["uiGmapIsReady","$http","LayerService",function(a,b,c){return{restrict:"E",template:"",scope:{},controller:["$scope",function(d){c.loadLayer("abc"),c.loadLayer("def"),a.promise(1).then(function(a){function e(){if(d.featureMap&&d.countMap){console.log("$countMap",d.countMap);var a=d3.scale.linear().domain([d.countMap.$min,d.countMap.$max]).range(["#F7FBFF","#08306B"]);f.data.setStyle(function(b){var c=b.getProperty("NAME"),e=d.countMap[c],f={strokeOpacity:1,strokeColor:"#ffffff",strokeWeight:1,fillOpacity:0};return e?(f.fillOpacity=.8,f.fillColor=a(e.number_stations),f.clickable=!0):console.warn("no count for "+c),f}),f.data.addListener("mouseover",function(a){console.log("feature",a.feature),console.log("state",a.feature.getProperty("NAME")),f.data.overrideStyle(a.feature,{strokeWeight:2})}),f.data.addListener("mouseout",function(){f.data.revertStyle()}),c.loadLayer("hij")}}var f=a[0].map;b.get("layers/us-states.geojson").success(function(a){console.debug(a),f.data.addGeoJson(a);var b={};f.data.setStyle(function(a){b[a.getProperty("NAME")]=a,console.log(a.getProperty("NAME"),a);var c={strokeOpacity:0,fillOpacity:0};return c}),d.featureMap=b}),b.get("/npn_portal/stations/getStationCountByState.json").success(function(a){var b={$max:0};a.forEach(function(a){a.number_stations=parseInt(a.number_stations),(void 0===b.$min||a.number_stations<b.$min)&&(b.$min=a.number_stations),a.number_stations>b.$max&&(b.$max=a.number_stations),b[a.state]=a}),d.countMap=b}),d.$watch("countMap",e),d.$watch("featureMap",e)})}]}}]),angular.module("templates-npnvis",["js/map/map.html"]),angular.module("js/map/map.html",[]).run(["$templateCache",function(a){a.put("js/map/map.html","<ui-gmap-google-map ng-if=\"map\" center='map.center' zoom='map.zoom' options=\"map.options\">\n\n</ui-gmap-google-map>\n\n<npn-viz-layers></npn-viz-layers>")}]),angular.module("npn-viz-tool.services",["ngResource"]).factory("LayerService",["$http","$q","uiGmapIsReady",function(a,b,c){function d(c){var d=b.defer();return c.data?d.resolve(c):a.get("layers/"+c.file).success(function(a){c.data=a,d.resolve(c)}),d.promise}var e=null,f=null,g=c.promise(1).then(function(b){return f=b[0].map,console.log("LayerService - map is ready"),a.get("layers/layers.json").success(function(a){e={},a.forEach(function(a){e[a.label]=a}),console.log("LayerService - layer list is loaded",e)})});return{resetLayers:function(){var a=b.defer();return g.then(function(){for(var b in e){var c,d=e[b];if(d.loaded){for(c=0;c<d.loaded.length;c++)f.data.remove(d.loaded[c]);delete d.loaded}}a.resolve()}),a.promise},loadLayer:function(a){var c=b.defer();return g.then(function(){var b=e[a];return b?void d(b).then(function(){b.loaded=f.data.addGeoJson(b.data),c.resolve(f,b.loaded)}):(console.log("no such layer labeled",a),c.reject(a))}),c.promise}}}]);